<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notizen</title>
    <style>
      .sidebar {
        height: 100vh;
        width: 20%;
        background-color: #e2e2e2;
        position: fixed;
        overflow-y: auto;
      }

      .notizfeld {
        margin-left: 20%;
        height: 96vh;
        width: 78%;
        position: absolute;
        padding: 1%;
        background-color: #f2f2f2;
      }

      .newNotiz {
        width: 100%;
        height: 10vh;
        background-color: #d94862;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 2vh;
      }

      .newNotiz:hover {
        background-color: #c03756;
      }

      .note {
        background-color: #f2b950;
        margin-top: 5px;
        height: 15vh;
        width: 100%;
        border: none;
        cursor: pointer;
        color: #5a5a5a;
        font-size: 2vh;
        position: relative;
      }

      .note:hover {
        background-color: #ce9e46;
      }

      #ueberschrift {
        width: 75%;
        height: 5vh;
        font-size: 2.5vh;
        background: none;
        border-radius: 0;
        border: none;
        outline: none;
        border-bottom: 2px solid #4b4b4b;
      }

      #ueberschrift:focus {
        border-bottom: 2px solid #00ee00;
      }

      .saveButton {
        width: 15%;
        height: 5.5vh;
        background-color: #bf8f73;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 2vh;
        margin-left: 5%;
      }

      .saveButton:hover {
        background-color: #9c755d;
      }

      #notiz {
        height: 90vh;
        width: 100%;
        margin-top: 10px;
        font-size: 2vh;
        outline: none;
        border: none;
        background-color: #e2e2e2;
        color: #222222;
      }

      .trash {
        width: 5.5vh;
        height: 5.5vh;
        background-image: url("icons/trash-close.png");
        background-size: cover;
        border: none;
        cursor: pointer;
        position: absolute;
        top: 2.1vh;
        left: 95%;
      }

      .trash:hover {
        background-image: url("icons/trash-open.png");
        background-size: cover;
      }

      .header {
        width: 100%;
      }

      .datum {
        font-size: 1vh;
        margin-left: 79%;
      }

      .usbsr {
        margin-left: 5%;
        padding-top: 20px;
      }
    </style>
  </head>
  <body style="margin: 0">
    <div class="sidebar">
      <button onclick="createNewNote()" class="newNotiz">
        Neue Notiz erstellen...
      </button>
      <div id="notesList"></div>
    </div>
    <div class="notizfeld">
      <div id="noteEditor">
        <div class="header">
          <input
            type="text"
            name="notizenUeberschrift"
            id="ueberschrift"
            placeholder="Überschrift eingeben...."
          />
          <button onclick="addNewNote()" class="saveButton">Speichern</button>
          <button
            id="deleteButton"
            style="background-color: rgb(167, 46, 46)"
            onclick="loeschen(); event.stopPropagation();"
            class="trash"
          ></button>
        </div>
        <div class="card-body">
          <textarea
            name="notiz"
            id="notiz"
            placeholder="Notiz eingeben....."
          ></textarea>
        </div>
      </div>
    </div>

    <script>
      let currentNoteId = null;

      function addNewNote() {
        const ueber = document.getElementById("ueberschrift").value;
        const notiz = document.getElementById("notiz").value;
        const lastUpdated = new Date().toISOString();

        if (ueber && notiz) {
          if (currentNoteId === null) {
            const id = Math.random();
            const speichern = {
              id: id,
              notizenUeberschrift: ueber,
              notiz: notiz,
              lastUpdated: lastUpdated,
            };

            saveToLocalStorage(speichern);
          } else {
            updateNoteInLocalStorage(currentNoteId, ueber, notiz, lastUpdated);
          }

          document.getElementById("ueberschrift").value = "";
          document.getElementById("notiz").value = "";
          currentNoteId = null;

          displayNotes();
        } else {
          alert(
            "Speichern nicht möglich, Bitte geben Sie eine Überschrift und eine Notiz ein."
          );
        }
      }

      function saveToLocalStorage(speichern) {
        let gespeicherteNotizen =
          JSON.parse(localStorage.getItem("notizen")) || [];
        gespeicherteNotizen.push(speichern);
        localStorage.setItem("notizen", JSON.stringify(gespeicherteNotizen));
      }

      function updateNoteInLocalStorage(id, ueber, notiz, lastUpdated) {
        let gespeicherteNotizen =
          JSON.parse(localStorage.getItem("notizen")) || [];
        gespeicherteNotizen = gespeicherteNotizen.map((note) => {
          if (note.id === id) {
            note.notizenUeberschrift = ueber;
            note.notiz = notiz;
            note.lastUpdated = lastUpdated;
          }
          return note;
        });
        localStorage.setItem("notizen", JSON.stringify(gespeicherteNotizen));
      }

      function loeschen() {
        if (currentNoteId !== null) {
          loescheNoteFromLocalStorage(currentNoteId);
          document.getElementById("ueberschrift").value = "";
          document.getElementById("notiz").value = "";
          currentNoteId = null;
          displayNotes();
        } else {
          alert("Keine Notiz zum Löschen ausgewählt.");
        }
      }

      function loescheNoteFromLocalStorage(id) {
        let gespeicherteNotizen =
          JSON.parse(localStorage.getItem("notizen")) || [];
        gespeicherteNotizen = gespeicherteNotizen.filter(
          (note) => note.id !== id
        );
        localStorage.setItem("notizen", JSON.stringify(gespeicherteNotizen));
      }

      function displayNotes() {
        const notesList = document.getElementById("notesList");
        notesList.innerHTML = "";

        let gespeicherteNotizen =
          JSON.parse(localStorage.getItem("notizen")) || [];

        gespeicherteNotizen.forEach((note) => {
          const noteDiv = document.createElement("div");
          noteDiv.classList.add("note");
          noteDiv.onclick = (event) => {
            event.stopPropagation();
            editNote(note.id);
          };

          noteDiv.innerHTML = `
            <p class="usbsr">Überschrift: ${escapeHtml(
              note.notizenUeberschrift
            )}</p>
            <p class="usbsr">Notiz: ${escapeHtml(note.notiz)}</p>
            <div class="datum">Zuletzt aktualisiert: ${new Date(
              note.lastUpdated
            ).toLocaleString()}</div>
          `;

          notesList.appendChild(noteDiv);
        });
      }

      function editNote(id) {
        let gespeicherteNotizen =
          JSON.parse(localStorage.getItem("notizen")) || [];
        const noteToEdit = gespeicherteNotizen.find((note) => note.id === id);

        if (noteToEdit) {
          document.getElementById("ueberschrift").value =
            noteToEdit.notizenUeberschrift;
          document.getElementById("notiz").value = noteToEdit.notiz;
          currentNoteId = id;
        }
      }

      function createNewNote() {
        document.getElementById("ueberschrift").value = "";
        document.getElementById("notiz").value = "";
        currentNoteId = null;
      }

      document.addEventListener("DOMContentLoaded", () => {
        displayNotes();
      });

      function escapeHtml(unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      function unescapeHtml(safe) {
        return safe
          .replace(/&amp;/g, "&")
          .replace(/&lt;/g, "<")
          .replace(/&gt;/g, ">")
          .replace(/&quot;/g, '"')
          .replace(/&#039;/g, "'");
      }
    </script>
  </body>
</html>
